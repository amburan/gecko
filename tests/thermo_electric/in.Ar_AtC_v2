units		real
atom_style	charge
dimension       3

# create domain
lattice         fcc 5.405 origin 0.25 0.25 0.25

region		simRegion block -10 10 -10 10 0 20
region		mdRegion block -5 5 -5 5 5 15
boundary	p p p

create_box	1 mdRegion
create_atoms 1 region mdRegion

group Ar type 1

mass 1 39.95

#kspace_style    ewald 1.0e-6
#kspace_modify slab nozforce

# specify interal/ghost atoms

group mdGroup region mdRegion
region		mdInternal block -5 5 -5 5 6 14
group		internal region mdInternal
group		ghost subtract all internal
group 		internal_Ar intersect Ar mdGroup

set group internal_Ar charge 0.0000666

pair_style	lj/cut 13.5
#pair_coeff	1 1 0.010323166 3.405 13.5
pair_coeff  	1 1 .238 3.405 13.5

neighbor 0.3 bin
neigh_modify every 20 delay 0 check no



#MINIMIZATION
print "----------------------MINIMIZATION--------------------"
minimize 0.0 1.0e-8 1000 100000


#DYNAMIC EQUILIBRIATION
print "----------------------DYNAMIC EQUILIBRIATION (NVT)--------------------"
velocity	internal create 200.0 87287 mom yes loop geom
variable xdof equal 3*count(ghost)
compute_modify thermo_temp extra ${xdof}
thermo_style custom step cpu etotal pe temp
thermo_modify  format 1 %6i format 2 %7.2g
fix eq all nvt temp 200.0 200.0 10.0
# equilibrate MD field
dump            D3 all atom 100 dump.equilibrium_nvt
timestep	5
thermo		100
run 		1000
unfix eq


print "----------------------DYNAMIC EQUILIBRIATION (ATC)--------------------"
#               ID  group atc PhysicsType ParameterFile
fix             AtC internal   atc thermal     Ar_thermal.mat
fix_modify      AtC atom_weight constant internal_Ar 39.95
fix_modify      AtC boundary ghost
fix_modify      AtC time_integration fractional_step

#               ID  part keywords    nx ny nz region
fix_modify      AtC mesh create 2 2 4  simRegion p p p
# fix a temperature
fix_modify     	AtC  fix temperature all 200.
# turn on thermostat
fix_modify	AtC  control thermal rescale 10
dump            D4 all atom 100 dump.equilibrium_atc
timestep	1
thermo		100
run 		1000

#PRODUCTION
print "----------------------PRODUCTION--------------------"
# change thermostat to hoover
fix_modify	AtC  unfix temperature all
fix_modify	AtC  control thermal none
fix_modify	AtC  control thermal flux interpolate
fix_modify AtC control max_iterations 100
fix_modify AtC control tolerance 1.e-6
fix_modify      AtC  output EQ_ATC 100 text binary

#fix_modify	AtC  control localized_lambda on
#fix_modify	AtC  thermal control flux faceset obndy
fix_modify      AtC  filter type exponential
fix_modify	AtC  filter scale 100.0
#fix_modify	AtC  filter on


# add nodesets
#               ID  mesh create_nodeset tag xmin xmax ymin ymax zmin zmax
fix_modify      AtC mesh create_nodeset tbc -INF INF -INF INF 19 21
fix_modify      AtC mesh create_nodeset bbc -INF INF -INF INF -1 1

# set up output, should be before a "run"
fix_modify      AtC  output PROD_ATC 100 text binary
# ouput command
dump            D1 all atom 100 dump.production
# run with FE
reset_timestep 0
timestep	1
thermo		100

fix_modify      AtC  fix temperature tbc 450
fix_modify      AtC  fix temperature bbc 200
run 		10000
